#!/usr/bin/env php
<?php

require realpath(__DIR__ . '/Import.php');

use Phpkg\Classes\Environment\Environment;
use PhpRepos\Cli\IO\Read;
use PhpRepos\FileManager\Path;
use function Phpkg\Exception\register_exception_handler;
use function PhpRepos\FileManager\File\exists;

register_exception_handler();

$command = Read\command() ?? Read\parameter('command');

if (is_null($command)) {
    $command = Read\option('v') || Read\option('version') ? 'version' : (Read\option('man') ? 'man' : 'help');
}

$environment = new Environment(Path::from_string(__DIR__));

$command = ucfirst($command);

if (exists(__DIR__ . "/Source/Commands/$command.php")) {
    $command = require realpath(__DIR__ . "/Source/Commands/$command.php");
} else {
    $command = require realpath(__DIR__ . '/Source/Commands/Help.php');
}

$command($environment);
